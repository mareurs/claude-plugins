# /document Command

Generate and synchronize documentation from code using Serena.

## Usage

```
/document <mode> [options]

Modes:
  bootstrap    Create documentation structure from scratch
  sync         Update existing docs to match current code
  status       Show documentation coverage report

Options:
  --adrs           Generate Architecture Decision Records
  --readme         Generate README files
  --architecture   Generate architecture overview with diagrams
  --all            Generate all documentation types
  --path <dir>     Target specific directory/component
  --from-spec <name>  Link ADRs to a spec (extracts context from spec/plan)
```

## Purpose

Generates documentation by analyzing code with Serena. Inverse of `/drift` (docs → code), this is code → docs.

## Modes

### `/document bootstrap`

Creates documentation structure from scratch for projects without documentation.

**Process:**
1. **Scan** - Analyze codebase with Serena
2. **Detect** - Identify patterns, stack, architecture
3. **Generate** - Create documentation files
4. **Review** - Present for human approval before writing
5. **Persist** - Update Serena memory with discovered knowledge

**Example:**
```
/document bootstrap --all
/document bootstrap --adrs --readme
/document bootstrap --architecture --path src/core/
```

### `/document sync`

Updates existing documentation to match current code state.

**Process:**
1. **Scan** - Analyze current codebase
2. **Compare** - Diff against existing documentation
3. **Identify** - Find new patterns, removed components, changes
4. **Update** - Propose documentation updates
5. **Review** - Present changes for approval
6. **Persist** - Update Serena memory with changes

**Example:**
```
/document sync                    # Sync all configured doc types
/document sync --adrs             # Only sync ADRs
/document sync --path src/auth/   # Sync docs for specific module
/document sync --from-spec user-auth  # Sync with spec traceability
```

### `/document status`

Shows documentation coverage without making changes.

Reports on ADRs, READMEs, architecture docs, and API docs - what exists, what's outdated, overall coverage percentage.

## Spec-Aware ADR Generation

When using `--from-spec <spec-name>`, the command links ADRs to their originating specification, creating complete traceability.

### Process

1. **Read Spec** (`memory/specs/<spec-name>.md`):
   - Extract **Problem Statement** → becomes ADR **Context**
   - Extract **Technical Approach** → becomes ADR **Decision** basis

2. **Read Plan** (`memory/plans/<spec-name>/plan.md`) if exists:
   - Extract architectural choices from phases
   - Note implementation approach decisions

3. **Scan Code** with Serena:
   - Detect implemented patterns
   - Gather evidence (file locations, code patterns)

4. **Generate Spec-Aware ADRs**:
   - Add "Spec Reference" and "Plan Reference" link headers
   - Context section notes "From spec: [problem statement]"
   - Evidence shows implemented reality vs. spec intention
   - Spec Alignment section shows compliance

### Standard ADR Template

```markdown
# ADR-NNNN: [Title]

**Status:** Accepted (inferred from code)
**Date:** YYYY-MM-DD
**Confidence:** ⭐⭐⭐ High

## Context

[Why this decision was likely made, inferred from code patterns]

## Decision

[The architectural decision detected in the codebase]

## Evidence

| Location | Pattern Match |
|----------|---------------|
| `src/...` | [detected pattern] |

## Consequences

### Positive
- [Inferred benefits]

### Negative
- [Inferred tradeoffs]

---
*This ADR was auto-generated by /document. Review and adjust as needed.*
```

### Spec-Aware ADR Template

```markdown
# ADR-NNNN: [Pattern/Decision Name]

**Status:** Accepted
**Date:** YYYY-MM-DD
**Spec Reference:** [memory/specs/<spec-name>.md](../memory/specs/<spec-name>.md)
**Plan Reference:** [memory/plans/<spec-name>/plan.md](../memory/plans/<spec-name>/plan.md)
**Confidence:** ⭐⭐⭐ High

## Context

_From spec:_ [Problem Statement extracted from spec]

_Additional context:_ [Technical Approach from spec that led to this decision]

## Decision

[The architectural decision - from Technical Approach + detected implementation]

## Evidence (Detected)

| Location | Pattern Match |
|----------|---------------|
| `src/...` | [detected pattern] |

## Consequences

### Positive
- [From spec's expected benefits + observed reality]

### Negative
- [From spec's noted tradeoffs + observed reality]

### Spec Alignment
- ✅ Matches spec requirement: [specific criterion]
- ⚠️ Deviation: [if any, with explanation]

---
*This ADR was generated by `/document sync --from-spec <spec-name>`.
Linked to spec for traceability.*
```

## Human Review Gate

Before writing any files, the command presents generated documentation for approval. Lists detected patterns with confidence levels, document summaries, and asks whether to review individually, write all, or regenerate with different settings.

## Serena Memory Persistence

After documentation is written, discovered knowledge (project overview, detected patterns, component map, tech stack) is persisted to Serena's memory system. Future sessions start with this context, avoiding re-discovery.

## Integration with SDD

| Scenario | Workflow |
|----------|----------|
| New SDD project | `/specify` → `/plan` → implement → `/document bootstrap` |
| **Complete SDD workflow** | `/specify` → `/plan` → implement → `/review` (GO) → `/document sync --from-spec` |
| Legacy project adoption | `/document bootstrap` → review → then use SDD going forward |
| After implementation | implement → `/document sync` → `/review` → `/commit` |
| Drift detected | `/drift` finds issues → fix code OR `/document sync` to update docs |

## Tips

- Start with `/document status` to see coverage
- Always review generated docs before accepting
- Iterate: generate, review, adjust config, regenerate
- Combine with `/drift` to keep code and docs in sync
- Trust but verify: generated ADRs capture patterns, humans understand intent
